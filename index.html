<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Î§ÏÏŒÎ½Î¹Î± Î Î¿Î»Î»Î¬, Î‘Ï†ÏÎ¿Î´Î¯Ï„Î·</title>
  <style>
    :root{
      --bg1:#ffe6f1;
      --bg2:#fff6d6;
      --bg3:#e9fbff;

      --card: rgba(255,255,255,.78);
      --stroke: rgba(0,0,0,.08);
      --ink:#1b1b1b;
      --muted:#5b5b5b;

      --accent:#ff4d7d;
      --accent2:#39c6a5;
      --accent3:#ffb547;

      --shadow: 0 18px 60px rgba(0,0,0,.14);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      color:var(--ink);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding: 22px 14px;

      background:
        radial-gradient(900px 520px at 20% 10%, rgba(57,198,165,.25), transparent 60%),
        radial-gradient(900px 600px at 80% 0%, rgba(255,77,125,.22), transparent 55%),
        radial-gradient(900px 650px at 60% 95%, rgba(255,181,71,.20), transparent 55%),
        linear-gradient(180deg, var(--bg3) 0%, var(--bg1) 45%, var(--bg2) 100%);
    }

    .wrap{ width:min(1020px, 100%); display:grid; gap:14px; }

    .stage{
      position:relative;
      border-radius: var(--radius);
      background: rgba(255,255,255,.55);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    canvas#confetti{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index: 10;
    }

    .content{ position:relative; padding: 18px; z-index: 2; }

    .topRow{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      background: rgba(255,255,255,.78);
      border: 1px solid var(--stroke);
      border-radius: 999px;
      box-shadow: 0 10px 26px rgba(0,0,0,.06);
      backdrop-filter: blur(6px);
      color: var(--muted);
      font-size: 14px;
      margin:0;
    }

    /* Layout fix: keep a nicer â€œcardâ€ height, avoid awkward tall columns */
    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    .box{
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: var(--card);
      box-shadow: 0 14px 30px rgba(0,0,0,.06);
      overflow:hidden;
    }

    /* Panda frame: fixed-ish height so it doesn't blow up the page */
    .heroFrame{
      width:100%;
      height: min(58vh, 560px);
      background: rgba(0,0,0,.03);
      position:relative;
      overflow:hidden;
    }
    @media (max-width: 860px){
      .heroFrame{ height: min(46vh, 520px); }
    }
    .heroFrame img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    .inner{ padding: 14px; display:grid; gap:12px; }

    .btn{
      appearance:none;
      border:0;
      border-radius: 999px;
      padding: 12px 16px;
      font-weight: 800;
      cursor:pointer;
      color:white;
      background: linear-gradient(90deg, var(--accent), #ff7aa0);
      box-shadow: 0 14px 32px rgba(255,77,125,.28);
      transition: transform .15s ease, filter .15s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .progressWrap{
      display:none;
      gap:10px;
    }
    .progressWrap.show{ display:grid; }

    .bar{
      height: 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.08);
      overflow:hidden;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent2), var(--accent), var(--accent3));
      transition: width .35s ease;
    }

    .wishText{
      margin:0;
      font-size: 15px;
      line-height:1.5;
      min-height: 3em;
    }

    .stepImageBox{
      display:none;
      border-radius: 16px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.72);
      overflow:hidden;
      box-shadow: 0 14px 28px rgba(0,0,0,.08);
    }
    .stepImageBox.show{ display:block; animation: pop .5s cubic-bezier(.2,.9,.2,1); }
    @keyframes pop{
      0%{ transform: translateY(10px) scale(.98); opacity:0; }
      100%{ transform: translateY(0) scale(1); opacity:1; }
    }
    .stepImageBox img{ width:100%; height:auto; display:block; }

    /* Micro effects layer near step images */
    .fxLayer{
      position:relative;
      border-radius: 16px;
      overflow:hidden;
    }
    .petal, .spark, .popper{
      position:absolute;
      pointer-events:none;
      opacity:0;
    }

    /* Gift opening mini scene */
    .giftWrap{
      display:none;
      align-items:center;
      justify-content:center;
      padding: 10px 0 2px 0;
    }
    .giftWrap.show{ display:flex; }
    .gift{
      width: 86px;
      height: 70px;
      position:relative;
      transform: translateY(6px) scale(.98);
      opacity:0;
      animation: giftIn .55s ease forwards;
    }
    @keyframes giftIn{
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    .gift .box{
      position:absolute; left:0; right:0; bottom:0;
      height: 46px;
      border-radius: 12px;
      background: rgba(255,77,125,.85);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 14px 26px rgba(0,0,0,.10);
    }
    .gift .ribbonV{
      position:absolute; left:50%; bottom:0;
      width: 10px; height: 46px;
      transform: translateX(-50%);
      background: rgba(255,255,255,.86);
      border-radius: 8px;
    }
    .gift .ribbonH{
      position:absolute; left:0; right:0; bottom: 18px;
      height: 10px;
      background: rgba(255,255,255,.86);
      border-radius: 8px;
    }
    .gift .lid{
      position:absolute; left:-2px; right:-2px; bottom: 36px;
      height: 22px;
      border-radius: 12px;
      background: rgba(57,198,165,.85);
      border: 1px solid rgba(0,0,0,.10);
      transform-origin: 10% 90%;
      animation: lidOpen .75s .15s cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes lidOpen{
      0%{ transform: rotate(0deg) translateY(0); }
      100%{ transform: rotate(-18deg) translateY(-6px); }
    }
    .gift .bowL, .gift .bowR{
      position:absolute; bottom: 54px; width: 18px; height: 12px;
      background: rgba(255,255,255,.88);
      border-radius: 12px 12px 12px 12px;
      opacity:.95;
    }
    .gift .bowL{ left: 34px; transform: rotate(-18deg); }
    .gift .bowR{ right: 34px; transform: rotate(18deg); }

    /* Final reveal */
    .reveal{
      display:none;
      margin-top: 6px;
      border-radius: 18px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.86);
      overflow:hidden;
      box-shadow: 0 18px 46px rgba(0,0,0,.10);
    }
    .reveal.show{ display:block; }

    .banner{
      padding: 14px 14px 12px 14px;
      background:
        radial-gradient(800px 260px at 20% 40%, rgba(57,198,165,.22), transparent 60%),
        radial-gradient(800px 260px at 70% 0%, rgba(255,77,125,.22), transparent 60%),
        radial-gradient(700px 240px at 70% 100%, rgba(255,181,71,.20), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.84));
      border-bottom: 1px solid var(--stroke);
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .banner h2{
      margin: 0;
      font-size: clamp(16px, 2.4vw, 22px);
      font-weight: 900;
      letter-spacing: -.02em;
      transform: translateY(6px);
      opacity:0;
    }
    .banner.show h2{
      animation: bannerIn .55s ease forwards;
    }
    @keyframes bannerIn{
      to{ transform: translateY(0); opacity:1; }
    }
    .sweep{
      position:absolute;
      inset:-60px;
      background: linear-gradient(115deg,
        rgba(255,255,255,0) 20%,
        rgba(255,255,255,.55) 40%,
        rgba(255,255,255,0) 60%);
      transform: translateX(-60%);
      opacity:0;
      pointer-events:none;
    }
    .banner.show .sweep{
      opacity:1;
      animation: sweep 1s ease forwards;
    }
    @keyframes sweep{
      to{ transform: translateX(60%); }
    }

    .photoWrap{
      padding: 14px;
      position:relative;
    }

    .photoFrame{
      border-radius: 16px;
      overflow:hidden;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.03);
      position:relative;
      box-shadow: 0 18px 50px rgba(0,0,0,.14);
      transform: translateZ(0);
      opacity:0;
      transform: translateY(10px) scale(.99);
    }
    .photoFrame.show{
      animation: photoIn .6s ease forwards;
    }
    @keyframes photoIn{
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    .photoFrame img{
      width:100%;
      height:auto;
      display:block;
      object-fit: cover;
    }

    /* Glow behind the photo (not on top) */
    .glowRing{
      position:absolute;
      inset: 4px;
      border-radius: 22px;
      background:
        conic-gradient(from 0deg,
          rgba(255,77,125,.0),
          rgba(255,77,125,.35),
          rgba(57,198,165,.35),
          rgba(255,181,71,.35),
          rgba(255,77,125,.35),
          rgba(255,77,125,.0));
      filter: blur(16px);
      opacity: .9;
      animation: spin 2.8s linear infinite;
      pointer-events:none;
      z-index: 0;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    /* Balloons (emoji) flying up during reveal, placed aroundâ€”not overâ€”photo */
    .balloonLayer{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index: 9;
      overflow:hidden;
    }
    .balloon{
      position:absolute;
      bottom: -60px;
      font-size: 34px;
      opacity: 0;
      transform: translateY(0);
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.12));
    }
    .balloon.fly{
      opacity: 1;
      animation: flyUp var(--dur) linear forwards;
    }
    @keyframes flyUp{
      from{ transform: translateY(0); }
      to{ transform: translateY(-120vh); }
    }

    .note{
      margin:0;
      padding: 0 14px 14px 14px;
      color: var(--muted);
      font-size: 12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="stage" id="stage">
      <canvas id="confetti"></canvas>

      <div class="content">
        <div class="topRow">
          <p class="pill">Î§ÏÏŒÎ½Î¹Î± Ï€Î¿Î»Î»Î¬ Î‘Ï†ÏÎ¿Î´Î¯Ï„Î·</p>
        </div>

        <div class="grid">
          <!-- Left: panda (fixed frame height for better layout) -->
          <div class="box">
            <div class="heroFrame">
              <img src="panda.png" alt="Birthday panda card"
                   onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('beforeend','<div style=&quot;padding:14px;color:#5b5b5b;font-size:14px;&quot;>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ <b>panda.png</b>.</div>');" />
            </div>
          </div>

          <!-- Right: wishes + steps + reveal -->
          <div class="box">
            <div class="inner">
              <button class="btn" id="mainBtn" type="button">Press Î³Î¹Î± Î³ÎµÎ½ÎµÎ¸Î»Î¹Î±ÎºÎ­Ï‚ ÎµÏ…Ï‡Î­Ï‚</button>

              <!-- Gift opening mini animation (first click only) -->
              <div class="giftWrap" id="giftWrap" aria-hidden="true">
                <div class="gift">
                  <div class="lid"></div>
                  <div class="bowL"></div>
                  <div class="bowR"></div>
                  <div class="box"></div>
                  <div class="ribbonV"></div>
                  <div class="ribbonH"></div>
                </div>
              </div>

              <div class="progressWrap" id="progressWrap">
                <div class="bar" aria-label="progress"><div id="barFill"></div></div>
              </div>

              <p class="wishText" id="wishText"></p>

              <!-- Step images -->
              <div class="stepImageBox fxLayer" id="imgStep1">
                <img src="pizza.png" alt="Pizza Î¼Îµ ÎºÎµÏÎ¬ÎºÎ¹Î±"
                     onerror="this.style.display='none'; this.parentElement.style.display='none';" />
              </div>

              <div class="stepImageBox fxLayer" id="imgStep2">
                <img src="flowers.png" alt="Î‘Î½Î¸Î¿Î´Î­ÏƒÎ¼Î·"
                     onerror="this.style.display='none'; this.parentElement.style.display='none';" />
              </div>

              <div class="stepImageBox fxLayer" id="imgStep3">
                <img src="corgi.png" alt="Corgi"
                     onerror="this.style.display='none'; this.parentElement.style.display='none';" />
              </div>

              <!-- Final reveal -->
              <div class="reveal" id="reveal">
                <div class="banner" id="banner">
                  <div class="sweep" aria-hidden="true"></div>
                  <h2>Î£' Î±Î³Î±Ï€Î¬Ï‰ Ï€Î¿Î»Ï Ï†Î¯Î»Î· Î¼Î¿Ï…â¤ï¸</h2>
                </div>

                <div class="photoWrap" id="photoWrap">
                  <div class="glowRing" aria-hidden="true"></div>

                  <div class="balloonLayer" id="balloonLayer" aria-hidden="true"></div>

                  <div class="photoFrame" id="photoFrame">
                    <img src="us.jpg" alt="Î— Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î± Î¼Î±Ï‚"
                         onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('beforeend','<div style=&quot;padding:14px;color:#5b5b5b;font-size:14px;&quot;>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ <b>us.jpg</b>.</div>');" />
                  </div>
                </div>

                <p class="note">Î‘Î»Î»Î¬Î¶ÎµÎ¹Ï‚ Î¼ÏŒÎ½Î¿ Ï„Î¹Ï‚ 3 ÎµÏ…Ï‡Î­Ï‚ ÏƒÏ„Î¿ JavaScript, ÎºÎ±Î¹ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎµÎ¹ÎºÏŒÎ½Ï‰Î½ (panda.png, pizza.png, flowers.png, corgi.png, us.jpg).</p>
              </div>

            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    (function(){
      // ====== Î‘Î›Î›Î‘Î–Î•Î™Î£ ÎœÎŸÎÎŸ Î‘Î¥Î¤Î•Î£ Î¤Î™Î£ 3 Î•Î¥Î§Î•Î£ ======
      const wishes = [
        "Î•Î¥Î§Î— 1 (placeholder) â€” Î¬Î»Î»Î±Î¾Î­ Î¼Îµ",
        "Î•Î¥Î§Î— 2 (placeholder) â€” Î¬Î»Î»Î±Î¾Î­ Î¼Îµ",
        "Î•Î¥Î§Î— 3 (placeholder) â€” Î¬Î»Î»Î±Î¾Î­ Î¼Îµ"
      ];
      // ============================================

      const stage = document.getElementById('stage');
      const mainBtn = document.getElementById('mainBtn');

      const giftWrap = document.getElementById('giftWrap');

      const progressWrap = document.getElementById('progressWrap');
      const barFill = document.getElementById('barFill');

      const wishText = document.getElementById('wishText');
      const reveal = document.getElementById('reveal');

      const img1 = document.getElementById('imgStep1');
      const img2 = document.getElementById('imgStep2');
      const img3 = document.getElementById('imgStep3');

      const banner = document.getElementById('banner');
      const photoFrame = document.getElementById('photoFrame');
      const balloonLayer = document.getElementById('balloonLayer');

      let step = 0;          // 0..3
      let openedGift = false;

      function hideStepImages(){
        img1.classList.remove('show');
        img2.classList.remove('show');
        img3.classList.remove('show');
      }

      function setProgress(s){
        const pct = Math.round((s / 3) * 100);
        barFill.style.width = pct + "%";
      }

      function sparkleBox(el){
        // quick sparkles around the box
        const rect = el.getBoundingClientRect();
        for(let i=0;i<10;i++){
          const s = document.createElement('div');
          s.className = 'spark';
          s.style.left = (6 + Math.random()*(rect.width-12)) + 'px';
          s.style.top = (6 + Math.random()*(rect.height-12)) + 'px';
          s.style.width = (6 + Math.random()*8) + 'px';
          s.style.height = s.style.width;
          s.style.borderRadius = '999px';
          s.style.background = 'rgba(255,255,255,0.9)';
          s.style.boxShadow = '0 0 0 2px rgba(255,181,71,.35), 0 0 18px rgba(255,181,71,.35)';
          s.style.opacity = '0';
          s.style.transform = 'scale(0.6)';
          s.style.transition = 'opacity .25s ease, transform .25s ease';
          el.appendChild(s);

          requestAnimationFrame(() => {
            s.style.opacity = '1';
            s.style.transform = 'scale(1)';
          });

          setTimeout(() => {
            s.style.opacity = '0';
            s.style.transform = 'scale(0.6)';
            setTimeout(() => s.remove(), 250);
          }, 260 + Math.random()*200);
        }
      }

      function petals(el){
        // small â€œpetalsâ€ falling inside the box for a moment
        const rect = el.getBoundingClientRect();
        for(let i=0;i<14;i++){
          const p = document.createElement('div');
          p.className = 'petal';
          p.style.left = (10 + Math.random()*(rect.width-20)) + 'px';
          p.style.top = (-10 - Math.random()*40) + 'px';
          p.style.width = (6 + Math.random()*8) + 'px';
          p.style.height = (10 + Math.random()*10) + 'px';
          p.style.borderRadius = '999px';
          p.style.background = (Math.random() < 0.5) ? 'rgba(255,77,125,.55)' : 'rgba(255,181,71,.45)';
          p.style.opacity = '0.95';
          p.style.transform = 'rotate(' + ((Math.random()*40)-20) + 'deg)';
          p.style.transition = 'transform 1.1s ease, top 1.1s ease, opacity 1.1s ease';
          el.appendChild(p);

          requestAnimationFrame(() => {
            p.style.top = (rect.height + 20) + 'px';
            p.style.transform = 'rotate(' + ((Math.random()*120)-60) + 'deg)';
            p.style.opacity = '0.0';
          });

          setTimeout(() => p.remove(), 1150);
        }
      }

      function pop(el){
        el.animate([
          { transform: 'translateY(0) scale(1)' },
          { transform: 'translateY(-6px) scale(1.02)' },
          { transform: 'translateY(0) scale(1)' }
        ], { duration: 420, easing: 'cubic-bezier(.2,.9,.2,1)' });
      }

      async function playGiftOnce(){
        if(openedGift) return;
        openedGift = true;

        giftWrap.classList.add('show');
        burstConfetti(35);

        // wait a bit for the lid animation + effect, then hide
        await new Promise(r => setTimeout(r, 850));
        giftWrap.classList.remove('show');
      }

      function showStep(s){
        progressWrap.classList.add('show');
        hideStepImages();

        wishText.textContent = wishes[s - 1];
        setProgress(s);

        if(s === 1){
          img1.classList.add('show');
          burstConfetti(65);
          sparkleBox(img1);
        }
        if(s === 2){
          img2.classList.add('show');
          burstConfetti(55);
          petals(img2);
        }
        if(s === 3){
          img3.classList.add('show');
          burstConfetti(75);
          pop(img3);
        }
      }

      function smoothScrollToReveal(){
        // a bit of delay so the reveal has layout
        setTimeout(() => {
          reveal.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 60);
      }

      function spawnBalloons(){
        balloonLayer.innerHTML = "";

        // place balloons left/right sides of the photo area, not covering the image
        const specs = [
          { left: '6%',  dur: '4.6s', size: 34, emoji:'ğŸˆ' },
          { left: '14%', dur: '5.2s', size: 30, emoji:'ğŸˆ' },
          { left: '86%', dur: '4.9s', size: 34, emoji:'ğŸˆ' },
          { left: '78%', dur: '5.6s', size: 30, emoji:'ğŸˆ' },
          { left: '92%', dur: '5.1s', size: 28, emoji:'ğŸˆ' }
        ];

        for(const sp of specs){
          const b = document.createElement('div');
          b.className = 'balloon';
          b.textContent = sp.emoji;
          b.style.left = sp.left;
          b.style.setProperty('--dur', sp.dur);
          b.style.fontSize = sp.size + 'px';
          balloonLayer.appendChild(b);

          // stagger start
          const delay = 120 + Math.random()*420;
          setTimeout(() => b.classList.add('fly'), delay);
        }
      }

      function doReveal(){
        reveal.classList.add('show');
        banner.classList.add('show');
        smoothScrollToReveal();

        // Stage 1: banner + sweep
        burstConfetti(110);

        // Stage 2: photo in
        setTimeout(() => {
          photoFrame.classList.add('show');
          burstConfetti(170);
          startConfettiShower(2200);
          spawnBalloons();
        }, 320);

        // clean step visuals
        hideStepImages();

        mainBtn.disabled = true;
        mainBtn.textContent = "ğŸ‰";
      }

      mainBtn.addEventListener('click', async () => {
        if(step === 0){
          await playGiftOnce();
        }

        if(step < 3){
          step++;
          showStep(step);
          mainBtn.textContent = (step === 3) ? "Reveal" : "Î•Ï€ÏŒÎ¼ÎµÎ½Î¿";
        } else {
          doReveal();
        }
      });

      // ===== Confetti (canvas) =====
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');

      let confetti = [];
      let raf = null;
      let showerTimer = null;

      function resize(){
        const rect = canvas.parentElement.getBoundingClientRect();
        canvas.width = Math.floor(rect.width * devicePixelRatio);
        canvas.height = Math.floor(rect.height * devicePixelRatio);
        canvas.style.width = rect.width + 'px';
        canvas.style.height = rect.height + 'px';
        ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
      }
      window.addEventListener('resize', resize);
      resize();

      function pickColor(){
        const palette = [
          "rgba(255,77,125,0.95)",
          "rgba(57,198,165,0.95)",
          "rgba(255,181,71,0.95)",
          "rgba(111,81,255,0.75)",
          "rgba(0,0,0,0.35)"
        ];
        return palette[(Math.random()*palette.length)|0];
      }

      function burstConfetti(n){
        resize();
        const rect = canvas.getBoundingClientRect();
        for(let i=0;i<n;i++){
          confetti.push({
            x: rect.width * (0.12 + 0.76*Math.random()),
            y: rect.height * (0.06 + 0.18*Math.random()),
            vx: (Math.random()-0.5) * 7,
            vy: - (6 + Math.random()*7),
            g: 0.22 + Math.random()*0.14,
            w: 5 + Math.random()*10,
            h: 5 + Math.random()*12,
            r: Math.random()*Math.PI,
            vr: (Math.random()-0.5)*0.25,
            life: 0,
            max: 120 + Math.floor(Math.random()*70),
            c: pickColor()
          });
        }
        if(!raf) animate();
      }

      function startConfettiShower(ms){
        if(showerTimer) clearInterval(showerTimer);
        const start = performance.now();
        showerTimer = setInterval(() => {
          const t = performance.now() - start;
          if(t > ms){
            clearInterval(showerTimer);
            showerTimer = null;
            return;
          }
          burstConfetti(18);
        }, 120);
      }

      function animate(){
        raf = requestAnimationFrame(animate);
        const rect = canvas.getBoundingClientRect();
        ctx.clearRect(0,0,rect.width,rect.height);

        confetti = confetti.filter(p => p.life < p.max);
        for(const p of confetti){
          p.life++;
          p.vy += p.g;
          p.x += p.vx;
          p.y += p.vy;
          p.r += p.vr;

          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.r);
          ctx.fillStyle = p.c;
          ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
          ctx.restore();
        }

        if(confetti.length === 0){
          cancelAnimationFrame(raf);
          raf = null;
        }
      }

      // Initial state
      wishText.textContent = "";
      barFill.style.width = "0%";
    })();
  </script>
</body>
</html>
